drop database theknife_db

create database theknife_db

create table restaurantes
    -> (ID_RESTAURANTE char(7) NOT NULL,
    -> NOMBRE char(30) NOT NULL,
    -> CIUDAD char(20) NOT NULL,
    -> CCAA char(20) NOT NULL,
    -> T_COMIDA char(20) NOT NULL,
    -> PRESUPUESTO INTEGER NOT NULL,
    -> ESTRELLA_MICH INTEGER NOT NULL,
    -> CADENA char(20) NULL,
    -> CONSTRAINT PKRT PRIMARY KEY (ID_RESTAURANTE),
    -> CONSTRAINT IND1 UNIQUE(ID_RESTAURANTE)
    -> );

create table clientes
    -> (ID_CLIENTE char(9) NOT NULL,
    -> N_CLIENTE char(30) NOT NULL,
    -> NUM_TELEFONO integer NOT NULL,
    -> EMAIL char(50) NULL,
    -> ESTUDIOS char(20) NOT NULL,
    -> SEXO char(1) NOT NULL,
    -> EDAD integer NOT NULL;
    -> CONSTRAINT PKC PRIMARY KEY (ID_CLIENTE),
    -> CONSTRAINT IND1 UNIQUE (ID_CLIENTE)
    -> );

create table platos
    -> (ID_RESTAURANTE char(7) NOT NULL,
    -> N_PLATO char(30) NOT NULL,
    -> T_PLATO char(20) NOT NULL,
    -> PRECIO decimal(6,2) NOT NULL,
    -> CONSTRAINT PKP PRIMARY KEY (ID_RESTAURANTE, N_PLATO),
    -> CONSTRAINT FKP FOREIGN KEY (ID_RESTAURANTE) references restaurantes(ID_RESTAURANTE) ON DELETE RESTRICT
    -> );

create table reservas
    -> (ID_RESERVA char(8) NOT NULL,
    -> ID_CLIENTE char(9) NOT NULL,
    -> NUM_PERSONAS INTEGER NOT NULL,
    -> FECHA_RESERVA char(10) NOT NULL,
    -> HORA_RESERVA char(5) NOT NULL,
    -> ID_RESTAURANTE char(7) NOT NULL,
    -> ESTADO_RESERVA char(10) NOT NULL,
    -> CONSTRAINT PKRV PRIMARY KEY (ID_RESERVA, ID_RESTAURANTE),
    -> CONSTRAINT UNIQUE (ID_RESERVA),
    -> CONSTRAINT FKRV1 FOREIGN KEY (ID_RESTAURANTE) references restaurantes(ID_RESTAURANTE) ON DELETE RESTRICT,
    -> CONSTRAINT FKRV2 FOREIGN KEY (ID_CLIENTE) references clientes(ID_CLIENTE) ON DELETE RESTRICT
    -> );

create table facturas
    -> (ID_FACTURA char(8) NOT NULL,
    -> ID_CLIENTE char(9) NOT NULL,
    -> ID_RESERVA char(8) NULL,
    -> PRECIO decimal(6,2) NOT NULL,
    -> VALORACION decimal(2,1) NULL,
    -> TIPO_VISITA char(20) NOT NULL,
    -> FECHA_FACTURA char(10) NOT NULL;
    -> ID_RESTAURANTE char(7),
    -> CONSTRAINT PKF PRIMARY KEY (ID_FACTURA, ID_RESTAURANTE),
    -> CONSTRAINT UNIQUE (ID_FACTURA),
    -> CONSTRAINT FKF1 FOREIGN KEY (ID_CLIENTE) references clientes(ID_CLIENTE) ON DELETE RESTRICT,
    -> CONSTRAINT FKF2 FOREIGN KEY (ID_RESERVA) references reservas(ID_RESERVA) ON DELETE RESTRICT,
    -> CONSTRAINT FKF3 FOREIGN KEY (ID_RESTAURANTE) references restaurantes(ID_RESTAURANTE) ON DELETE RESTRICT
    -> );

create table resenas
    -> (ID_FACTURA char(8) NOT NULL,
    -> VALORACION decimal(2,1) NOT NULL,
    -> TIPO_VISITA char(20) NOT NULL,
    -> CONSTRAINT PKRN PRIMARY KEY (ID_FACTURA),
    -> CONSTRAINT FKRN1 FOREIGN KEY (ID_FACTURA) references facturas(ID_FACTURA) ON DELETE RESTRICT,
    -> );

create table alergenos
    -> (ALERGENO char(15) NOT NULL,
    -> NUM_ALERGENO int NOT NULL,
    -> CONSTRAINT PKAL PRIMARY KEY (ALERGENO),
    -> CONSTRAINT UNIQUE (ALERGENO)
    -> );

create table alergias
    -> (ID_RESTAURANTE char(7) NOT NULL,
    -> N_PLATO char(30) NOT NULL,
    -> NUM_ALERGENO int NOT NULL,
    -> CONSTRAINT PKAS PRIMARY KEY (ID_RESTAURANTE, N_PLATO, NUM_ALERGENO),
    -> CONSTRAINT FKAS1 FOREIGN KEY (ID_RESTAURANTE) references restaurantes(ID_RESTAURANTE) ON DELETE RESTRICT,
    -> CONSTRAINT FKAS2 FOREIGN KEY (N_PLATO) references platos(N_PLATO) ON DELETE RESTRICT,
    -> CONSTRAINT FKAS3 FOREIGN KEY (NUM_ALERGENO) references alergenos(NUM_ALERGENO) ON DELETE RESTRICT
    -> );

create table comandas
    -> (N_PLATO char(30) NOT NULL,
    -> ID_FACTURA char(8) NOT NULL,
    -> NUM_PEDIDOS int NOT NULL,
    -> CONSTRAINT PKCM PRIMARY KEY (N_PLATO, ID_FACTURA),
    -> CONSTRAINT FKCM1 FOREIGN KEY (N_PLATO) references platos(N_PLATO) ON DELETE RESTRICT,
    -> CONSTRAINT FKCM2 FOREIGN KEY (ID_FACTURA) references facturas(ID_FACTURA) ON DELETE RESTRICT
    -> );
